<?xml version="1.0" encoding="UTF-8"?>

<beans
	xsi:schemaLocation="http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
          http://www.springframework.org/schema/context
          http://www.springframework.org/schema/context/spring-context-3.0.xsd
          http://www.springframework.org/schema/security
          http://www.springframework.org/schema/security/spring-security-3.1.xsd"
	xmlns:sec="http://www.springframework.org/schema/security" xmlns:ctx="http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.springframework.org/schema/beans">

	<!--<ctx:property-override
			location="WEB-INF/config-security/config-security-cda-overrides.properties"
			ignore-resource-not-found="true" />-->

	<bean id="cdaAuthenticationProvider"
		  class="org.fao.geonet.kernel.security.cda.CdaAuthenticationProvider">
	</bean>

	<bean id="formLoginFilter"
		  class="org.fao.geonet.kernel.security.cda.CdaUserAuthenticationFilter">
		<property name="postOnly" value="true" />
		<property name="usernameParameter" value="username" />
		<property name="passwordParameter" value="password" />
		<property name="keyParameter" value="key" />
		<property name="authenticationManager" ref="authenticationManager" />
		<property name="filterProcessesUrl" value="/j_spring_security_check" />
		<property name="authenticationDetailsSource" ref="authenticationDetailsSource" />
		<property name="authenticationFailureHandler">
			<bean class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler">
				<constructor-arg value="${loginErrorForm}"></constructor-arg>
				<property name="redirectStrategy">
					<bean class="jeeves.config.springutil.JeevesNodeAwareRedirectStrategy"/>
				</property>
			</bean>
		</property>
		<property name="authenticationSuccessHandler">
			<bean class="org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler">
				<property name="defaultTargetUrl" value="/" />
				<property name="targetUrlParameter" value="redirectUrl" />
			</bean>
		</property>
		<property name="sessionAuthenticationStrategy">
			<bean class="org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy" />
		</property>
	</bean>

	<bean id="authenticationManager"
		class="org.springframework.security.authentication.ProviderManager">
		<constructor-arg index="0">
			<list>
				<ref bean="cdaAuthenticationProvider" />
			</list>
		</constructor-arg>
	</bean>
</beans>
